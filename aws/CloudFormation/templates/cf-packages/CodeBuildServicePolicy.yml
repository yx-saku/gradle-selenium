Version: 2012-10-17
Statement:
# S3バケットへのアクセス
-   Effect: Allow
    Action:
    - s3:GetObject
    - s3:ListBucket
    - s3:PutObject
    Resource:
    - !ImportValue S3BucketArn
    - !Sub [ "${S3BucketArn}/test-reports/*", { S3BucketArn: !ImportValue S3BucketArn } ]   # テストレポートの出力
    - !Sub [ "${S3BucketArn}/logs/codebuild/*", { S3BucketArn: !ImportValue S3BucketArn } ] # CodeBuild実行ログ
    - !Sub [ "${S3BucketArn}/temp-testcases/*", { S3BucketArn: !ImportValue S3BucketArn } ] # Lambda関数から取得したテストケースへのアクセス
# ロググループの作成とログ出力を許可
-   Effect: Allow
    Action:
    - logs:CreateLogStream
    - logs:PutLogEvents
    Resource:
    - !GetAtt CodeBuildLogGroup.Arn
    #- !Sub "${CodeBuildLogGroup.Arn}:*"
## JUnitテストレポートの出力
#-   Effect: Allow
#    Action:
#    - codebuild:CreateReportGroup
#    - codebuild:CreateReport
#    - codebuild:UpdateReport
#    - codebuild:BatchPutTestCases
#    - codebuild:BatchPutCodeCoverages
#    Resource:
#    - !Sub "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:report-group/user-bsdxxxx-${Env}-build-*"
# パラメータストアからのパラメータを取得を許可
-   Effect: Allow
    Action:
    - ssm:GetParameters
    Resource:
    - !Sub "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:parameter/CodeBuild/*"