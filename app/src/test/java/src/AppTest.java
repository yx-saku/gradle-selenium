/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package src;

import static com.codeborne.selenide.Selenide.$;
import static com.codeborne.selenide.Selenide.$$;
import static com.codeborne.selenide.Selenide.open;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;

import javax.imageio.ImageIO;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;

import com.codeborne.selenide.CollectionCondition;
import com.codeborne.selenide.Configuration;
import com.codeborne.selenide.Selenide;
import com.codeborne.selenide.logevents.SelenideLogger;

import io.github.bonigarcia.wdm.WebDriverManager;
import io.qameta.allure.Allure;
import io.qameta.allure.selenide.AllureSelenide;
import ru.yandex.qatools.ashot.AShot;
import ru.yandex.qatools.ashot.Screenshot;
import ru.yandex.qatools.ashot.shooting.ShootingStrategies;

class AppTest {
    @BeforeAll
    public static void setUp() {
        System.out.println(System.getProperty("selenide.browser"));
        SelenideLogger.addListener("AllureSelenide", new AllureSelenide());
        WebDriverManager.chromedriver().setup();
        WebDriverManager.firefoxdriver().setup();
        WebDriverManager.edgedriver().setup();
        Allure.suite(Configuration.browser);
    }

    @Test
    void openUrl() throws IOException {
        // Open Google search page
        open("https://www.google.com");

        // Type "Hello, world!" in the search box and submit
        $("[name=q]").setValue("Hello, world!!!!!!!").pressEnter();

        // Check if search results are displayed
        $$("#search .g").shouldHave(CollectionCondition.sizeGreaterThan(0));

        Screenshot screenshot = new AShot()
                .shootingStrategy(ShootingStrategies.viewportPasting(100))
                .takeScreenshot(Selenide.webdriver().object());

        try (ByteArrayOutputStream outputStream = new ByteArrayOutputStream()) {
            ImageIO.write(screenshot.getImage(), "PNG", outputStream);
            Allure.addAttachment("キャプチャ", new ByteArrayInputStream(outputStream.toByteArray()));
        }
    }
}
