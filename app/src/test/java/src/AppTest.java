/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package src;

import static com.codeborne.selenide.Selenide.$;
import static com.codeborne.selenide.Selenide.open;

import java.io.IOException;
import java.util.Properties;

import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;

import com.codeborne.selenide.Configuration;
import com.codeborne.selenide.logevents.SelenideLogger;

import io.github.bonigarcia.wdm.WebDriverManager;
import io.qameta.allure.Allure;
import io.qameta.allure.selenide.AllureSelenide;
import src.utils.ScreenshotUtils;

class AppTest {
    @BeforeAll
    public static void beforeAll() {
        SelenideLogger.addListener("AllureSelenide", new AllureSelenide());
        WebDriverManager.chromedriver().setup();
        WebDriverManager.firefoxdriver().setup();
        WebDriverManager.edgedriver().setup();

        Properties properties = new Properties();

        // 環境情報を追加
        properties.setProperty("os.name", System.getProperty("os.name"));
        properties.setProperty("os.version", System.getProperty("os.version"));
        properties.setProperty("java.version", System.getProperty("java.version"));

        // その他の環境情報を追加する場合、以下のように記述
        // properties.setProperty("key", "value");

        // allure-resultsディレクトリにenvironment.propertiesファイルを作成
        /*
         * String allureResultsPath =
         * Paths.get("allure-results").toAbsolutePath().toString();
         * try (FileOutputStream outputStream = new FileOutputStream(allureResultsPath +
         * "/environment.properties")) {
         * properties.store(outputStream, "Environment properties");
         * } catch (IOException e) {
         * e.printStackTrace();
         * }
         */

        System.setProperty("selenide.headless", "true");
    }

    @AfterAll
    public static void afterAll() {
    }

    @Test
    void openUrl() throws IOException {
        String fileName = "chrome.png";

        Allure.label("testType", "screenshotDiff");

        // Open Google search page
        open("https://www.google.com");

        ScreenshotUtils.takeScreenshot(fileName);

        // Type "Hello, world!" in the search box and submit
        $("[name=q]")
                .setValue("Hello, world!!!!!!! " + Configuration.browser + " " + System.getProperty("selenide.browser"))
                .pressEnter();

        ScreenshotUtils.moveCapture2reference(fileName);
        ScreenshotUtils.takeScreenshot(fileName);

        // Check if search results are displayed
        // $$("#search .g").shouldHave(CollectionCondition.sizeGreaterThan(0));

        ScreenshotUtils.compareScreenshot(fileName);
    }
}
